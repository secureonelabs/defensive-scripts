
/*
Author carlos.perez<at>trustedsec.com

Description: LogParser 2.2 query to look for HAFNIUM exploit attempts that creat a JS file with a name of 1 ot 10 charecters long.
 
Version: 1.0
*/
SELECT date,time,cs-uri-stem,cs-uri-query,c-ip,cs-method,sc-status,cs(user-agent),Logfilename 
FROM '<path to logs>\W3SVC1\*.log'
-- Look for .JS request in the known paths used to exploit.
WHERE ((extract_path(cs-uri-stem) like '/ecp' and extract_extension(cs-uri-stem) like 'js' and strlen(extract_filename(cs-uri-stem)) between 3 and 13) OR 
(extract_path(cs-uri-stem) like '/owa/auth' and extract_extension(cs-uri-stem) like 'js' and strlen(extract_filename(cs-uri-stem)) between 3 and 13)